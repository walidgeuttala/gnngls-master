device = cuda
  0%|          | 0/10 [00:00<?, ?it/s]  0%|          | 0/10 [01:59<?, ?it/s, Train Loss=0.0131, Validation Loss=0.0027, correlation : =0.8109, cosin correlation : =0.9758, gap : =23.8111] 10%|█         | 1/10 [01:59<17:51, 119.10s/it, Train Loss=0.0131, Validation Loss=0.0027, correlation : =0.8109, cosin correlation : =0.9758, gap : =23.8111] 10%|█         | 1/10 [03:57<17:51, 119.10s/it, Train Loss=0.0023, Validation Loss=0.0028, correlation : =0.8419, cosin correlation : =0.9791, gap : =19.4341] 20%|██        | 2/10 [03:57<15:48, 118.54s/it, Train Loss=0.0023, Validation Loss=0.0028, correlation : =0.8419, cosin correlation : =0.9791, gap : =19.4341] 20%|██        | 2/10 [05:55<15:48, 118.54s/it, Train Loss=0.0020, Validation Loss=0.0025, correlation : =0.8658, cosin correlation : =0.9821, gap : =17.8830] 30%|███       | 3/10 [05:55<13:47, 118.27s/it, Train Loss=0.0020, Validation Loss=0.0025, correlation : =0.8658, cosin correlation : =0.9821, gap : =17.8830] 30%|███       | 3/10 [07:53<13:47, 118.27s/it, Train Loss=0.0019, Validation Loss=0.0024, correlation : =0.8735, cosin correlation : =0.9831, gap : =18.3086] 40%|████      | 4/10 [07:53<11:50, 118.46s/it, Train Loss=0.0019, Validation Loss=0.0024, correlation : =0.8735, cosin correlation : =0.9831, gap : =18.3086] 40%|████      | 4/10 [09:52<11:50, 118.46s/it, Train Loss=0.0017, Validation Loss=0.0021, correlation : =0.8893, cosin correlation : =0.9851, gap : =17.4905] 50%|█████     | 5/10 [09:52<09:52, 118.54s/it, Train Loss=0.0017, Validation Loss=0.0021, correlation : =0.8893, cosin correlation : =0.9851, gap : =17.4905] 50%|█████     | 5/10 [11:51<09:52, 118.54s/it, Train Loss=0.0016, Validation Loss=0.0022, correlation : =0.8922, cosin correlation : =0.9854, gap : =17.8245] 60%|██████    | 6/10 [11:51<07:54, 118.57s/it, Train Loss=0.0016, Validation Loss=0.0022, correlation : =0.8922, cosin correlation : =0.9854, gap : =17.8245] 60%|██████    | 6/10 [13:50<07:54, 118.57s/it, Train Loss=0.0016, Validation Loss=0.0021, correlation : =0.8952, cosin correlation : =0.9858, gap : =16.7859] 70%|███████   | 7/10 [13:50<05:56, 118.68s/it, Train Loss=0.0016, Validation Loss=0.0021, correlation : =0.8952, cosin correlation : =0.9858, gap : =16.7859] 70%|███████   | 7/10 [15:49<05:56, 118.68s/it, Train Loss=0.0016, Validation Loss=0.0020, correlation : =0.8981, cosin correlation : =0.9862, gap : =16.1360] 80%|████████  | 8/10 [15:49<03:57, 118.88s/it, Train Loss=0.0016, Validation Loss=0.0020, correlation : =0.8981, cosin correlation : =0.9862, gap : =16.1360] 80%|████████  | 8/10 [17:49<03:57, 118.88s/it, Train Loss=0.0016, Validation Loss=0.0018, correlation : =0.9009, cosin correlation : =0.9866, gap : =14.2671] 90%|█████████ | 9/10 [17:49<01:59, 119.38s/it, Train Loss=0.0016, Validation Loss=0.0018, correlation : =0.9009, cosin correlation : =0.9866, gap : =14.2671] 90%|█████████ | 9/10 [19:48<01:59, 119.38s/it, Train Loss=0.0015, Validation Loss=0.0018, correlation : =0.9029, cosin correlation : =0.9868, gap : =14.6335]100%|██████████| 10/10 [19:48<00:00, 119.19s/it, Train Loss=0.0015, Validation Loss=0.0018, correlation : =0.9029, cosin correlation : =0.9868, gap : =14.6335]100%|██████████| 10/10 [19:48<00:00, 118.87s/it, Train Loss=0.0015, Validation Loss=0.0018, correlation : =0.9029, cosin correlation : =0.9868, gap : =14.6335]
device = cuda
  0%|          | 0/10 [00:00<?, ?it/s]  0%|          | 0/10 [02:47<?, ?it/s, Train Loss=0.0121, Validation Loss=0.0031, correlation : =0.8320, cosin correlation : =0.9777, gap : =22.1664] 10%|█         | 1/10 [02:47<25:07, 167.50s/it, Train Loss=0.0121, Validation Loss=0.0031, correlation : =0.8320, cosin correlation : =0.9777, gap : =22.1664] 10%|█         | 1/10 [05:35<25:07, 167.50s/it, Train Loss=0.0024, Validation Loss=0.0037, correlation : =0.8556, cosin correlation : =0.9797, gap : =23.1070] 20%|██        | 2/10 [05:35<22:22, 167.83s/it, Train Loss=0.0024, Validation Loss=0.0037, correlation : =0.8556, cosin correlation : =0.9797, gap : =23.1070] 20%|██        | 2/10 [08:22<22:22, 167.83s/it, Train Loss=0.0022, Validation Loss=0.0023, correlation : =0.8616, cosin correlation : =0.9818, gap : =17.7038] 30%|███       | 3/10 [08:22<19:32, 167.44s/it, Train Loss=0.0022, Validation Loss=0.0023, correlation : =0.8616, cosin correlation : =0.9818, gap : =17.7038] 30%|███       | 3/10 [11:10<19:32, 167.44s/it, Train Loss=0.0020, Validation Loss=0.0023, correlation : =0.8643, cosin correlation : =0.9820, gap : =17.9260] 40%|████      | 4/10 [11:10<16:46, 167.67s/it, Train Loss=0.0020, Validation Loss=0.0023, correlation : =0.8643, cosin correlation : =0.9820, gap : =17.9260] 40%|████      | 4/10 [13:58<16:46, 167.67s/it, Train Loss=0.0019, Validation Loss=0.0022, correlation : =0.8689, cosin correlation : =0.9825, gap : =16.7474] 50%|█████     | 5/10 [13:58<13:58, 167.70s/it, Train Loss=0.0019, Validation Loss=0.0022, correlation : =0.8689, cosin correlation : =0.9825, gap : =16.7474] 50%|█████     | 5/10 [16:45<13:58, 167.70s/it, Train Loss=0.0018, Validation Loss=0.0020, correlation : =0.8790, cosin correlation : =0.9838, gap : =16.1820] 60%|██████    | 6/10 [16:45<11:10, 167.59s/it, Train Loss=0.0018, Validation Loss=0.0020, correlation : =0.8790, cosin correlation : =0.9838, gap : =16.1820] 60%|██████    | 6/10 [19:33<11:10, 167.59s/it, Train Loss=0.0017, Validation Loss=0.0018, correlation : =0.8918, cosin correlation : =0.9854, gap : =15.0276] 70%|███████   | 7/10 [19:33<08:22, 167.55s/it, Train Loss=0.0017, Validation Loss=0.0018, correlation : =0.8918, cosin correlation : =0.9854, gap : =15.0276] 70%|███████   | 7/10 [22:21<08:22, 167.55s/it, Train Loss=0.0017, Validation Loss=0.0017, correlation : =0.8958, cosin correlation : =0.9859, gap : =16.1645] 80%|████████  | 8/10 [22:21<05:35, 167.67s/it, Train Loss=0.0017, Validation Loss=0.0017, correlation : =0.8958, cosin correlation : =0.9859, gap : =16.1645] 80%|████████  | 8/10 [25:08<05:35, 167.67s/it, Train Loss=0.0016, Validation Loss=0.0017, correlation : =0.8974, cosin correlation : =0.9861, gap : =16.0589] 90%|█████████ | 9/10 [25:08<02:47, 167.53s/it, Train Loss=0.0016, Validation Loss=0.0017, correlation : =0.8974, cosin correlation : =0.9861, gap : =16.0589] 90%|█████████ | 9/10 [27:55<02:47, 167.53s/it, Train Loss=0.0016, Validation Loss=0.0017, correlation : =0.9022, cosin correlation : =0.9869, gap : =13.3688]100%|██████████| 10/10 [27:55<00:00, 167.31s/it, Train Loss=0.0016, Validation Loss=0.0017, correlation : =0.9022, cosin correlation : =0.9869, gap : =13.3688]100%|██████████| 10/10 [27:55<00:00, 167.51s/it, Train Loss=0.0016, Validation Loss=0.0017, correlation : =0.9022, cosin correlation : =0.9869, gap : =13.3688]
device = cuda
  0%|          | 0/10 [00:00<?, ?it/s]  0%|          | 0/10 [03:00<?, ?it/s, Train Loss=0.0129, Validation Loss=0.0078, correlation : =0.7413, cosin correlation : =0.9644, gap : =29.3933] 10%|█         | 1/10 [03:00<27:02, 180.26s/it, Train Loss=0.0129, Validation Loss=0.0078, correlation : =0.7413, cosin correlation : =0.9644, gap : =29.3933] 10%|█         | 1/10 [06:01<27:02, 180.26s/it, Train Loss=0.0029, Validation Loss=0.0039, correlation : =0.8204, cosin correlation : =0.9764, gap : =23.9257] 20%|██        | 2/10 [06:01<24:06, 180.77s/it, Train Loss=0.0029, Validation Loss=0.0039, correlation : =0.8204, cosin correlation : =0.9764, gap : =23.9257] 20%|██        | 2/10 [09:02<24:06, 180.77s/it, Train Loss=0.0026, Validation Loss=0.0037, correlation : =0.8406, cosin correlation : =0.9790, gap : =21.8614] 30%|███       | 3/10 [09:02<21:05, 180.84s/it, Train Loss=0.0026, Validation Loss=0.0037, correlation : =0.8406, cosin correlation : =0.9790, gap : =21.8614] 30%|███       | 3/10 [12:03<21:05, 180.84s/it, Train Loss=0.0023, Validation Loss=0.0029, correlation : =0.8701, cosin correlation : =0.9828, gap : =19.9998] 40%|████      | 4/10 [12:03<18:05, 180.94s/it, Train Loss=0.0023, Validation Loss=0.0029, correlation : =0.8701, cosin correlation : =0.9828, gap : =19.9998] 40%|████      | 4/10 [15:04<18:05, 180.94s/it, Train Loss=0.0018, Validation Loss=0.0028, correlation : =0.9084, cosin correlation : =0.9875, gap : =16.2404] 50%|█████     | 5/10 [15:04<15:05, 181.06s/it, Train Loss=0.0018, Validation Loss=0.0028, correlation : =0.9084, cosin correlation : =0.9875, gap : =16.2404] 50%|█████     | 5/10 [18:05<15:05, 181.06s/it, Train Loss=0.0015, Validation Loss=0.0021, correlation : =0.9166, cosin correlation : =0.9887, gap : =16.1399] 60%|██████    | 6/10 [18:05<12:04, 181.02s/it, Train Loss=0.0015, Validation Loss=0.0021, correlation : =0.9166, cosin correlation : =0.9887, gap : =16.1399] 60%|██████    | 6/10 [21:05<12:04, 181.02s/it, Train Loss=0.0014, Validation Loss=0.0018, correlation : =0.9219, cosin correlation : =0.9895, gap : =17.4347] 70%|███████   | 7/10 [21:05<09:01, 180.55s/it, Train Loss=0.0014, Validation Loss=0.0018, correlation : =0.9219, cosin correlation : =0.9895, gap : =17.4347] 70%|███████   | 7/10 [24:06<09:01, 180.55s/it, Train Loss=0.0013, Validation Loss=0.0016, correlation : =0.9249, cosin correlation : =0.9898, gap : =17.5209] 80%|████████  | 8/10 [24:06<06:01, 180.75s/it, Train Loss=0.0013, Validation Loss=0.0016, correlation : =0.9249, cosin correlation : =0.9898, gap : =17.5209] 80%|████████  | 8/10 [27:06<06:01, 180.75s/it, Train Loss=0.0012, Validation Loss=0.0015, correlation : =0.9290, cosin correlation : =0.9904, gap : =17.7760] 90%|█████████ | 9/10 [27:06<03:00, 180.50s/it, Train Loss=0.0012, Validation Loss=0.0015, correlation : =0.9290, cosin correlation : =0.9904, gap : =17.7760] 90%|█████████ | 9/10 [30:07<03:00, 180.50s/it, Train Loss=0.0012, Validation Loss=0.0016, correlation : =0.9300, cosin correlation : =0.9905, gap : =17.8498]100%|██████████| 10/10 [30:07<00:00, 180.82s/it, Train Loss=0.0012, Validation Loss=0.0016, correlation : =0.9300, cosin correlation : =0.9905, gap : =17.8498]100%|██████████| 10/10 [30:07<00:00, 180.79s/it, Train Loss=0.0012, Validation Loss=0.0016, correlation : =0.9300, cosin correlation : =0.9905, gap : =17.8498]
device = cuda
  0%|          | 0/10 [00:00<?, ?it/s]  0%|          | 0/10 [00:05<?, ?it/s]
Traceback (most recent call last):
  File "/project/p_gnn001/code/tsp/tsp/train2.py", line 333, in <module>
    main()
  File "/project/p_gnn001/code/tsp/tsp/train2.py", line 326, in main
    val_loss = run(args)
               ^^^^^^^^^
  File "/project/p_gnn001/code/tsp/tsp/train2.py", line 217, in run
    epoch_loss = train(model, train_loader, args.target, criterion, optimizer, device)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/project/p_gnn001/code/tsp/tsp/train2.py", line 50, in train
    y_pred = model(batch, x)
             ^^^^^^^^^^^^^^^
  File "/home/p_gnngw/miniconda3/envs/cuda118/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/p_gnngw/miniconda3/envs/cuda118/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/project/p_gnn001/code/tsp/tsp/gnngls/models.py", line 211, in forward
    h2 = gnn_layer(graph, h1)
         ^^^^^^^^^^^^^^^^^^^^
  File "/home/p_gnngw/miniconda3/envs/cuda118/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/p_gnngw/miniconda3/envs/cuda118/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/p_gnngw/miniconda3/envs/cuda118/lib/python3.12/site-packages/dgl/nn/pytorch/hetero.py", line 210, in forward
    dstdata = self._get_module((stype, etype, dtype))(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/p_gnngw/miniconda3/envs/cuda118/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/p_gnngw/miniconda3/envs/cuda118/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/p_gnngw/miniconda3/envs/cuda118/lib/python3.12/site-packages/dgl/nn/pytorch/conv/gatconv.py", line 340, in forward
    graph.edata["a"] = self.attn_drop(edge_softmax(graph, e))
                                      ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/p_gnngw/miniconda3/envs/cuda118/lib/python3.12/site-packages/dgl/ops/edge_softmax.py", line 136, in edge_softmax
    return edge_softmax_internal(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/p_gnngw/miniconda3/envs/cuda118/lib/python3.12/site-packages/dgl/backend/pytorch/sparse.py", line 1116, in edge_softmax
    return EdgeSoftmax.apply(*args)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/p_gnngw/miniconda3/envs/cuda118/lib/python3.12/site-packages/torch/autograd/function.py", line 553, in apply
    return super().apply(*args, **kwargs)  # type: ignore[misc]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/p_gnngw/miniconda3/envs/cuda118/lib/python3.12/site-packages/dgl/backend/pytorch/sparse.py", line 711, in forward
    score = th.exp(_gsddmm(gidx, "sub", score, score_max, "e", "v"))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 916.00 MiB. GPU 0 has a total capacity of 39.43 GiB of which 171.81 MiB is free. Including non-PyTorch memory, this process has 39.26 GiB memory in use. Of the allocated memory 37.21 GiB is allocated by PyTorch, and 622.74 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
